# Cloudformation Templates

## Firewatch CloudFormation Template

This project uses AWS CloudFormation to set up and manage the necessary resources in the cloud for processing and storing sensor data. The infrastructure was created using The Things Network AWS integration, which allows for seamless integration between TTN and AWS IoT services.

The CloudFormation stack sets up the following resources:

- ThingLogGroup: a CloudWatch Logs log group to store the logs generated by the AWS Lambda functions.
- KeyEncryptionKey: a KMS key used for encrypting and decrypting the keys used for secure communication between The Things Network and AWS.
- TheThingsStackRole: an AWS Identity and Access Management (IAM) role used by The Things Network to access AWS resources.
- ConfigureFunction: an AWS Lambda function used for configuring the TTN integration.
- Configuration: an AWS IoT Core configuration for storing the TTN integration configuration.
- CreateThingTypeFunction: an AWS Lambda function used for creating a new Thing Type in AWS IoT Core.
- ThingType: a Thing Type in AWS IoT Core for the firewatch sensors.
- HandleUplinkFunction: an AWS Lambda function used for handling uplink messages from TTN.
- InvokeHandleUplinkFunctionFromRule: an AWS IoT Rule used for invoking the HandleUplinkFunction from incoming uplink messages.
- HandleDownlinkAckRule: an AWS IoT Rule used for handling downlink acknowledgements from TTN.
- InvokeHandleDownlinkAckFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkAckFunction from incoming downlink - acknowledgements.
- HandleDownlinkNackRule: an AWS IoT Rule used for handling downlink negative acknowledgements from TTN.
- InvokeHandleDownlinkNackFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkNackFunction from incoming downlink negative acknowledgements.
- HandleDownlinkSentRule: an AWS IoT Rule used for handling downlink sent messages from TTN.
- InvokeHandleDownlinkSentFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkSentFunction from incoming downlink sent messages.
- HandleDownlinkQueuedRule: an AWS IoT Rule used for handling downlink queued messages from TTN.
- InvokeHandleDownlinkQueuedFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkQueuedFunction from incoming downlink queued messages.
- HandleDownlinkFailedRule: an AWS IoT Rule used for handling downlink failed messages from TTN.
- InvokeHandleDownlinkFailedFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkFailedFunction from incoming downlink failed messages.
- HandleJoinRule: an AWS IoT Rule used for handling join messages from TTN.
- InvokeHandleJoinFunctionFromRule: an AWS IoT Rule used for invoking the HandleJoinFunction from incoming join messages.
- HandleDownlinkQueueInvalidatedRule: an AWS IoT Rule used for handling downlink queue invalidated messages from TTN.
- InvokeHandleDownlinkQueueInvalidatedFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkQueueInvalidatedFunction from incoming downlink queue invalidated messages.
- HandleDownlinkFunction: an AWS Lambda function used for handling downlink messages from TTN.
- HandleDownlinkRule: an AWS IoT Rule used for invoking the HandleDownlinkFunction from incoming downlink messages.
- InvokeHandleDownlinkFunctionFromRule: an AWS IoT Rule used for invoking the HandleDownlinkFunction from incoming downlink messages.
- CreateThingFunction: an AWS Lambda function used for creating a new Thing in AWS IoT Core.
- CreateThingRule: an AWS IoT Rule used for invoking the CreateThingFunction from incoming create thing messages.
- InvokeCreateThingFunctionFromRule: an AWS IoT Rule used for invoking the CreateThingFunction from incoming create thing messages.
- DeleteThingFunction: an AWS Lambda function used for deleting a Thing from AWS IoT Core.
- DeleteThingRule: an AWS IoT Rule used for invoking the DeleteThingFunction from incoming delete thing messages.
- InvokeDeleteThingFunctionFromRule: This resource is a rule that invokes the DeleteThingFunction function whenever a message arrives on the - specified MQTT topic. The function is responsible for deleting a Thing (device) from the AWS IoT Core registry.
- CheckVersionAlarm: This resource is an alarm that triggers when a metric exceeds a specified threshold. In this case, the alarm is set to trigger when the device firmware version does not match the expected version.
- CheckVersionFunction: This resource is a Lambda function that is triggered by the CheckVersionEventsRule. It checks the firmware version of a device and publishes a message to an SNS topic if the version does not match the expected version.
- CheckVersionEventsRule: This resource is a rule that triggers the CheckVersionFunction Lambda function whenever a device sends data to the AWS IoT Core.

## Serverlessrepo-AthenaDynamoDBConnector CloudFormation Template

The resources defined in the template are:

- FunctionRole (AWS::IAM::Role): IAM Role for the Lambda function.
- FunctionExecutionPolicy (AWS::IAM::Policy): IAM Policy for the Lambda function's execution role, which provides permissions for accessing DynamoDB, Glue, Athena, and S3.